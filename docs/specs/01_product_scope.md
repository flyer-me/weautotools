# 高层产品范围与优先级

## 项目定位（摘要）
WeAutoTools 是一个面向企业和个人的自动化工具平台，用户可以浏览并使用多种自动化工具（RPA、脚本、模板等）。平台包含多租户角色：终端顾客（消费者）和商家（工具提供方/店家）。系统提供账户体系、OAuth2 认证、工具展示与使用、计费/充值、结算与统计、CI/CD 与监控能力。

## 主要用户角色
- 平台管理员（Admin）
  - 管理商家、审核上架、配置平台参数、查看账务统计与风控
- 商家（Merchant）
  - 提供工具/服务，管理商品上架、定价、促销、结算信息与账单
- 顾客（Customer / End User）
  - 浏览工具、下单、充值、消费、查看流水与账户余额
- 审计/财务用户（Finance）
  - 查看对账数据、导出账单、发起结算

## 核心业务场景（按优先级）
优先级说明：P0—必须、P1—重要、P2—可选/迭代

1. P0 — 用户认证与会话
   - OAuth2 集成（已有实现）
   - 注册/登录、令牌管理、受保护 API 访问

2. P0 — 顾客钱包/充值/消费
   - 顾客充值（第三方/手动）、消费扣款、余额与流水记录、退款
   - 安全（幂等、并发保护）、计费准确性

3. P0 — 商家上架商品/服务与定价
   - 商品/服务模型、上架/下架、库存（如适用）、可配置计费方式（按次/按量/包月/按时间段）
   - 商家入驻、认证与权限

4. P0 — 计费规则与订单执行
   - 下单、计费引擎应用计费规则、可支持优惠券/折扣、税/手续费（如果需要）

5. P1 — 结算与对账
   - 平台与商家结算周期、结算单、结算状态、提现（可选）

6. P1 — 管理端（平台）监控与统计
   - 订单/收入/充值/退款统计、导出报表

7. P2 — 促销与营销功能
   - 优惠券、分层定价、会员等级折扣

8. P2 — 产品化体验（工具 demo / 在线运行 / 权限细分）
   - 工具试用、限流、计费模拟器

## 成功标准（验收高层）
- 用户能完成注册、登录并获取访问受保护 API 的令牌（现有）
- 顾客可充值、下单并看到余额变动和流水记录（P0）
- 商家能上架商品并设置计费方式，顾客下单后计费规则生效（P0）
- 管理员可查看收入与订单简表（P1）
- 关键流程的 API 有 OpenAPI/Swagger 文档并覆盖基本单元/集成测试（开发规范）

## 关键非功能需求（NFR）
- 数据一致性：钱包/流水与订单需强一致或通过幂等/分布式事务策略保证可追溯性
- 安全性：OAuth2、角色权限校验、敏感操作审计
- 可观测性：Prometheus + Grafana 指标覆盖充值、订单、失败率
- 可扩展性：计费规则引擎可扩展支持新策略（插件化/规则配置化）
- 可运维性：审计日志、对账导出、管理员手动纠错/补账接口

## 建议的交付物（迭代输出）
- 里程碑 0（基础）：用户认证、顾客账户与钱包、商家基础信息、简单商品上架、简单计费（按次/固定价格）
  - 交付：数据库表 DDL、基础 API（CRUD）、示例前端流程、基本测试用例
- 里程碑 1（计费升级）：复杂计费规则（阶梯/包月）、退款/优惠券、后台统计
- 里程碑 2（结算与财务）：结算周期、结算单、对账工具、提现（或对接第三方）
- 里程碑 3（运维与扩展）：计费规则 UI、规则编辑器、灰度/AB 测试、监控完善
